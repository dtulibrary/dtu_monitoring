require 'spec_helper'

describe DtuMonitoring::BlacklightResponse do
  let(:response) { {"responseHeader"=>{
      "status"=>0, "QTime"=>577, "params"=>{
          "hl.fragsize"=>"300", "facet"=>"true", "sort"=>"score desc, pub_date_tsort desc, journal_vol_tsort desc, journal_issue_tsort desc, journal_page_start_tsort asc, title_sort asc", "stats"=>"true", "hl.fl"=>"title_ts, author_ts, journal_title_ts, conf_title_ts, abstract_ts, publisher_ts", "wt"=>"ruby", "hl"=>"true", "rows"=>"10", "f.source_ss.facet.limit"=>"11", "hl.snippets"=>"3", "stats.field"=>["pub_date_tsort", "submission_year_tis"], "q"=>"x", "f.author_facet.facet.limit"=>"11", "f.journal_title_facet.facet.limit"=>"11", "facet.field"=>["format_orig_s", "pub_date_tsort", "author_facet", "source_ss", "journal_title_facet", "submission_year_tis", "isolanguage_ss", "scientific_level_s", "access_condition_s", "review_status_s", "research_area_ss", "cris_id_ss", "is_active_b", "has_orcid_b"], "qt"=>"search", "hl.usePhraseHighlighter"=>"true", "fq"=>["NOT format:person", "{!raw f=source_ss}rdb_ku"]}}, "response"=>{"numFound"=>232343, "start"=>0, "maxScore"=>1.0, "docs"=>[{"alert_timestamp_dt"=>"2016-05-01T22:07:28.014Z", "isolanguage_ss"=>["eng"], "isolanguage_facet"=>["eng"], "research_area_ss"=>["Humanities"], "publisher_ts"=>["Edward Elgar"], "title_ts"=>["Contested Past: Social media and social memory in contemporary China"], "backlink_ss"=>["http://forskning.ku.dk/search/?pure=en/publications/id(93a52f2a-0630-43ee-96e7-1d2f262ba96c).html"], "source_ss"=>["rdb_ku"], "update_timestamp_dt"=>"2016-05-02T01:41:41.381Z", "cris_id_ss"=>["fcff9206-a61a-4892-9f88-8d197c0870f2"], "access_condition_s"=>"in_press", "affiliation_ts"=>["Department of Media, Cognition and Communication, Faculty of Humanities, Københavns Universitet", "Department of Media, Cognition and Communication, Faculty of Humanities, Københavns Universitet"], "format_orig_s"=>"dba", "scientific_level_s"=>"scientific", "fulltext_availability_ss"=>["UNDETERMINED"], "source_id_ss"=>["rdb_ku:93a52f2a-0630-43ee-96e7-1d2f262ba96c"], "source_type_ss"=>["research"], "affiliation_associations_json"=>"{\"editor\":[null],\"supervisor\":[],\"author\":[1]}", "access_ss"=>["ddf_publ", "dtu", "ddf_pers"], "journal_title_ts"=>["Handbook of Dissent and Protest in China"], "journal_title_facet"=>["Handbook of Dissent and Protest in China"], "subformat_s"=>"bookchapter", "member_id_ss"=>["57252aedbe6ff8a30400007a"], "review_status_s"=>"peer_review", "submission_year_tis"=>[2018], "language_ss"=>["eng"], "format"=>"article", "types_ss"=>["bib:article:bookchapter"], "pub_date_tis"=>[2018], "cluster_id_ss"=>["2304007298"], "author_ts"=>["Liu, Jun"], "author_facet"=>["Liu, Jun"], "superformat_s"=>"bib", "editor_ts"=>["Teresa Wright"], "source_ext_ss"=>["dads:rdb_ku"], "id"=>"1469405281", "_version_"=>1535377527790370816, "timestamp"=>"2016-05-26T08:08:34.241Z", "score"=>1.0}, {"alert_timestamp_dt"=>"2015-08-02T13:46:02.683Z", "isolanguage_ss"=>["eng"], "isolanguage_facet"=>["eng"], "research_area_ss"=>["Social science"], "publisher_ts"=>["Hart Publishing"], "title_ts"=>["Legal Responses to Autonomous Weapons Systems"], "backlink_ss"=>["http://forskning.ku.dk/search/?pure=en/publications/id(d8a3c23d-fc84-4646-90b2-919b6f03a8af).html"], "source_ss"=>["rdb_ku"], "update_timestamp_dt"=>"2016-05-26T09:59:40.229Z", "cris_id_ss"=>["6eabc201-1a46-4fa2-ade0-d68ad0859f89"], "access_condition_s"=>"in_press", "affiliation_ts"=>["Centre for international law, Conflict and Crisis, Area of Research, The Faculty of Law, Københavns Universitet", "Centre for international law, Conflict and Crisis, Area of Research, The Faculty of Law, Københavns Universitet"], "format_orig_s"=>"db", "scientific_level_s"=>"scientific", "fulltext_availability_ss"=>["UNDETERMINED"], "source_id_ss"=>["rdb_ku:d8a3c23d-fc84-4646-90b2-919b6f03a8af"], "source_type_ss"=>["research"], "affiliation_associations_json"=>"{\"editor\":[],\"supervisor\":[],\"author\":[1]}", "access_ss"=>["ddf_publ", "dtu", "ddf_pers"], "member_id_ss"=>["55a6301574b7847138000360"], "review_status_s"=>"peer_review", "submission_year_tis"=>[2018], "language_ss"=>["eng"], "format"=>"book", "types_ss"=>["bib:book"], "pub_date_tis"=>[2018], "cluster_id_ss"=>["2280082801"], "author_ts"=>["Liu, Hin-Yan"], "author_facet"=>["Liu, Hin-Yan"], "superformat_s"=>"bib", "source_ext_ss"=>["dads:rdb_ku"], "id"=>"1435909764", "_version_"=>1535377511882424323, "timestamp"=>"2016-05-26T08:08:19.062Z", "score"=>1.0}, {"alert_timestamp_dt"=>"2015-10-22T01:45:53.841Z", "isolanguage_ss"=>["eng"], "isolanguage_facet"=>["eng"], "research_area_ss"=>["Humanities"], "publisher_ts"=>["Routledge"], "title_ts"=>["‘Plato in the Renaissance’"], "backlink_ss"=>["http://forskning.ku.dk/search/?pure=en/publications/id(52fb61a2-f6cb-4a41-a162-a38f83ba09d8).html"], "source_ss"=>["rdb_ku"], "update_timestamp_dt"=>"2015-10-27T04:31:50.205Z", "cris_id_ss"=>["3b3b3384-e79a-4a87-9e0c-13d67d10dae8"], "access_condition_s"=>"unknown", "affiliation_ts"=>["Department of Media, Cognition and Communication, Faculty of Humanities, Københavns Universitet", "Department of Media, Cognition and Communication, Faculty of Humanities, Københavns Universitet"], "format_orig_s"=>"dba", "scientific_level_s"=>"scientific", "fulltext_availability_ss"=>["UNDETERMINED"], "source_id_ss"=>["rdb_ku:52fb61a2-f6cb-4a41-a162-a38f83ba09d8"], "source_type_ss"=>["research"], "affiliation_associations_json"=>"{\"editor\":[],\"supervisor\":[],\"author\":[1]}", "access_ss"=>["ddf_publ", "dtu", "ddf_pers"], "journal_title_ts"=>["Platonic Mind, Eds Vasilis Politis and Peter Larsen. Routledge, 2018"], "journal_title_facet"=>["Platonic Mind, Eds Vasilis Politis and Peter Larsen. Routledge, 2018"], "subformat_s"=>"bookchapter", "member_id_ss"=>["56236f0c84f76eb53b000058"], "review_status_s"=>"peer_review", "submission_year_tis"=>[2018], "language_ss"=>["eng"], "format"=>"article", "types_ss"=>["bib:article:bookchapter"], "pub_date_tis"=>[2018], "cluster_id_ss"=>["2287028849"], "author_ts"=>["Catana, Leo"], "author_facet"=>["Catana, Leo"], "superformat_s"=>"bib", "source_ext_ss"=>["dads:rdb_ku"], "id"=>"1445893859", "_version_"=>1535381457571151872, "timestamp"=>"2016-05-26T09:11:01.972Z", "score"=>1.0}, {"alert_timestamp_dt"=>"2016-03-28T23:22:45.849Z", "isolanguage_ss"=>["eng"], "isolanguage_facet"=>["eng"], "research_area_ss"=>["Humanities"], "publisher_ts"=>["T&T Clark International"], "title_ts"=>["The Qur'an and Political Theology"], "backlink_ss"=>["http://forskning.ku.dk/search/?pure=en/publications/id(3f16249b-422c-4bbc-a13a-1923c22416ed).html"], "source_ss"=>["rdb_ku"], "update_timestamp_dt"=>"2016-03-29T08:11:35.314Z", "cris_id_ss"=>["b5604146-41cd-44cb-a8d1-cce5bbf47adc"], "access_condition_s"=>"unknown", "affiliation_ts"=>["Department of Cross-Cultural and Regional Studies, Faculty of Humanities, Københavns Universitet", "Department of Cross-Cultural and Regional Studies, Faculty of Humanities, Københavns Universitet"], "format_orig_s"=>"dba", "scientific_level_s"=>"scientific", "fulltext_availability_ss"=>["UNDETERMINED"], "source_id_ss"=>["rdb_ku:3f16249b-422c-4bbc-a13a-1923c22416ed"], "orcid_ss"=>["0000-0001-8916-9352"], "source_type_ss"=>["research"], "affiliation_associations_json"=>"{\"editor\":[null],\"supervisor\":[],\"author\":[1]}", "access_ss"=>["ddf_publ", "dtu", "ddf_pers"], "journal_title_ts"=>["T&amp;t Clark Companion To Political Theology"], "journal_title_facet"=>["T&amp;t Clark Companion To Political Theology"], "subformat_s"=>"bookchapter", "review_status_s"=>"peer_review", "member_id_ss"=>["56ea3ac2667cf469560000b4"], "submission_year_tis"=>[2018], "language_ss"=>["eng"], "format"=>"article", "types_ss"=>["bib:article:bookchapter"], "pub_date_tis"=>[2018], "cluster_id_ss"=>["2298687301"], "author_ts"=>["Sabih, Joshua"], "author_facet"=>["Sabih, Joshua"], "superformat_s"=>"bib", "editor_ts"=>["Ruben Rosarion-Rodriguez"], "source_ext_ss"=>["dads:rdb_ku"], "id"=>"1467970187", "_version_"=>1535377525698461697, "timestamp"=>"2016-05-26T08:08:32.241Z", "score"=>1.0}, {"alert_timestamp_dt"=>"2016-04-19T00:53:55.14Z", "isolanguage_ss"=>["dan"], "isolanguage_facet"=>["dan"], "research_area_ss"=>["Humanities"], "title_ts"=>["Afbrydelsens kronotopi i britisk litteratur, 1840-1870 (arbejdstitel)"], "backlink_ss"=>["http://forskning.ku.dk/search/?pure=en/publications/id(8dddc410-fa8d-4d5b-8588-f4df38801ee3).html"], "source_ss"=>["rdb_ku"], "update_timestamp_dt"=>"2016-04-19T04:24:46.975Z", "cris_id_ss"=>["30d345df-5f32-466a-9137-170152b57dc9"], "access_condition_s"=>"in_press", "affiliation_ts"=>["Department of English, Germanic and Romance Studies, Faculty of Humanities, Københavns Universitet", "Department of English, Germanic and Romance Studies, Faculty of Humanities, Københavns Universitet"], "bfi_serial_no_ss"=>["4926"], "format_orig_s"=>"dja", "issn_ss"=>["09056998"], "scientific_level_s"=>"scientific", "fulltext_availability_ss"=>["UNDETERMINED"], "source_id_ss"=>["rdb_ku:8dddc410-fa8d-4d5b-8588-f4df38801ee3"], "source_type_ss"=>["research"], "affiliation_associations_json"=>"{\"editor\":[],\"supervisor\":[],\"author\":[1]}", "access_ss"=>["ddf_publ", "dtu", "ddf_pers"], "journal_title_ts"=>["K and K", "K and K"], "journal_title_facet"=>["K and K", "K and K"], "subformat_s"=>"journal_article", "submission_year_tis"=>[2017], "member_id_ss"=>["57150490f13df0d14f000012"], "review_status_s"=>"peer_review", "language_ss"=>["dan"], "format"=>"article", "types_ss"=>["bib:article:journal_article"], "pub_date_tis"=>[2017], "cluster_id_ss"=>["2303630206"], "author_ts"=>["Damkjær, Maria"], "author_facet"=>["Damkjær, Maria"], "superformat_s"=>"bib", "source_ext_ss"=>["dads:rdb_ku"], "id"=>"1469021783", "_version_"=>1535379417223659521, "timestamp"=>"2016-05-26T08:38:36.143Z", "score"=>1.0}, {"alert_timestamp_dt"=>"2015-05-01T23:07:33.017Z", "isolanguage_ss"=>["eng"], "isolanguage_facet"=>["eng"], "research_area_ss"=>["Humanities"], "publisher_ts"=>["Brill Adademic Publishers"], "title_ts"=>["Architecture and Control"], "backlink_ss"=>["http://forskning.ku.dk/search/?pure=en/publications/id(556e87e5-a03b-482b-96f9-6dd75019c509).html"], "source_ss"=>["rdb_ku"], "update_timestamp_dt"=>"2015-06-16T03:09:41.044Z", "cris_id_ss"=>["7e27f2ca-42fa-4fcb-8c23-4ed8cb9a461e", "23ec9d0a-0e15-4737-951f-a33a7d26cc9f"], "access_condition_s"=>"unknown", "affiliation_ts"=>["Department of Arts and Cultural Studies, Faculty of Humanities, Københavns Universitet", "Landscape Architecture and Planning, Department of Geosciences and Natural Resource Management, Faculty of Science, Københavns Universitet", "unknown", "Landscape Architecture and Planning, Department of Geosciences and Natural Resource Management, Faculty of Science, Københavns Universitet", "Department of Arts and Cultural Studies, Faculty of Humanities, Københavns Universitet"], "format_orig_s"=>"db", "scientific_level_s"=>"scientific", "fulltext_availability_ss"=>["UNDETERMINED"], "source_id_ss"=>["rdb_ku:556e87e5-a03b-482b-96f9-6dd75019c509"], "orcid_ss"=>["0000-0003-4766-7569"], "series_title_ts"=>["Architectural Intelligences"], "source_type_ss"=>["research"], "affiliation_associations_json"=>"{\"editor\":[2,3,4],\"supervisor\":[],\"author\":[]}", "access_ss"=>["ddf_publ", "dtu", "ddf_pers"], "member_id_ss"=>["5543707cf205def6510003eb"], "review_status_s"=>"peer_review", "submission_year_tis"=>[2017], "language_ss"=>["eng"], "format"=>"book", "types_ss"=>["bib:book"], "pub_date_tis"=>[2017], "cluster_id_ss"=>["2265057545"], "superformat_s"=>"bib", "editor_ts"=>["Ring, Annie", "Steiner, Henriette", "Veel, Kristin Eva Albrechtsen"], "source_ext_ss"=>["dads:rdb_ku"], "id"=>"1422920713", "_version_"=>1535381335599742978, "timestamp"=>"2016-05-26T09:09:05.645Z", "score"=>1.0}, {"alert_timestamp_dt"=>"2016-04-19T00:53:55.129Z", "isolanguage_ss"=>["eng"], "isolanguage_facet"=>["eng"], "research_area_ss"=>["Humanities"], "title_ts"=>["Awkward Appendages: Comic Umbrellas in Nineteenth-Century Print Culture"], "backlink_ss"=>["http://forskning.ku.dk/search/?pure=en/publications/id(a77c3001-3ed8-4610-b3fc-a0e1a646bb82).html"], "source_ss"=>["rdb_ku"], "update_timestamp_dt"=>"2016-04-19T04:24:46.974Z", "cris_id_ss"=>["30d345df-5f32-466a-9137-170152b57dc9"], "access_condition_s"=>"submitted", "affiliation_ts"=>["Department of English, Germanic and Romance Studies, Faculty of Humanities, Københavns Universitet", "Department of English, Germanic and Romance Studies, Faculty of Humanities, Københavns Universitet"], "bfi_serial_no_ss"=>["8259"], "format_orig_s"=>"dja", "issn_ss"=>["14701553", "10601503"], "scientific_level_s"=>"scientific", "fulltext_availability_ss"=>["UNDETERMINED"], "source_id_ss"=>["rdb_ku:a77c3001-3ed8-4610-b3fc-a0e1a646bb82"], "source_type_ss"=>["research"], "affiliation_associations_json"=>"{\"editor\":[],\"supervisor\":[],\"author\":[1]}", "access_ss"=>["ddf_publ", "dtu", "ddf_pers"], "journal_title_ts"=>["Victorian Literature and Culture", "Victorian Lit Cult", "Vic Lit Cult"], "journal_title_facet"=>["Victorian Literature and Culture", "Victorian Lit Cult", "Vic Lit Cult"], "subformat_s"=>"journal_article", "submission_year_tis"=>[2017], "member_id_ss"=>["57150490f13df0d14f000011"], "review_status_s"=>"peer_review", "language_ss"=>["eng"], "format"=>"article", "types_ss"=>["bib:article:journal_article"], "pub_date_tis"=>[2017], "cluster_id_ss"=>["2303630203"], "author_ts"=>["Damkjær, Maria"], "author_facet"=>["Damkjær, Maria"], "superformat_s"=>"bib", "source_ext_ss"=>["dads:rdb_ku"], "id"=>"1469021778", "_version_"=>1535377526541516800, "timestamp"=>"2016-05-26T08:08:33.049Z", "score"=>1.0}, {"alert_timestamp_dt"=>"2016-04-10T07:09:40.482Z", "isolanguage_ss"=>["eng"], "isolanguage_facet"=>["eng"], "research_area_ss"=>["Social science"], "publisher_ts"=>["Cambridge University Press"], "title_ts"=>["Building Legal Authority Beyond the State"], "backlink_ss"=>["http://forskning.ku.dk/search/?pure=en/publications/id(95fe51dd-b259-4539-bc61-caf952f031dd).html"], "source_ss"=>["rdb_ku"], "update_timestamp_dt"=>"2016-04-10T09:32:41.094Z", "cris_id_ss"=>["d6151186-5867-4059-bc35-8e82ae4be33e"], "access_condition_s"=>"in_press", "affiliation_ts"=>["Centre of Excellence for International Courts, Area of Research, The Faculty of Law, Københavns Universitet", "Faculty Management - allocation, Faculty Management, The Faculty of Law, Københavns Universitet", "Faculty Management - allocation, Faculty Management, The Faculty of Law, Københavns Universitet"], "format_orig_s"=>"dba", "scientific_level_s"=>"scientific", "fulltext_availability_ss"=>["UNDETERMINED"], "source_id_ss"=>["rdb_ku:95fe51dd-b259-4539-bc61-caf952f031dd"], "source_type_ss"=>["research"], "affiliation_associations_json"=>"{\"editor\":[],\"supervisor\":[],\"author\":[2]}", "access_ss"=>["ddf_publ", "dtu", "ddf_pers"], "journal_title_ts"=>["Legal Authority Beyond the State"], "journal_title_facet"=>["Legal Authority Beyond the State"], "subformat_s"=>"bookchapter", "subtitle_ts"=>["The Necessary Politics of International Courts"], "submission_year_tis"=>[2017], "member_id_ss"=>["5706840e365938571e00003e"], "review_status_s"=>"peer_review", "language_ss"=>["eng"], "format"=>"article", "types_ss"=>["bib:article:bookchapter"], "pub_date_tis"=>[2017], "cluster_id_ss"=>["2303348813"], "author_ts"=>["Olsen, Henrik Palmer"], "author_facet"=>["Olsen, Henrik Palmer"], "superformat_s"=>"bib", "source_ext_ss"=>["dads:rdb_ku"], "id"=>"1468629277", "_version_"=>1535381729071595520, "timestamp"=>"2016-05-26T09:15:20.893Z", "score"=>1.0}, {"alert_timestamp_dt"=>"2015-12-03T03:55:44.033Z", "isolanguage_ss"=>["eng"], "isolanguage_facet"=>["eng"], "journal_subtitle_ts"=>["Taleskrivning I Vores Tid"], "research_area_ss"=>["Humanities"], "publisher_ts"=>["Texas A&M University Press"], "title_ts"=>["Characterising the Speaker"], "backlink_ss"=>["http://forskning.ku.dk/search/?pure=en/publications/id(f3be054a-85f7-463f-ae2f-8ebb2c2f3273).html"], "source_ss"=>["rdb_ku"], "update_timestamp_dt"=>"2015-12-05T09:22:29.201Z", "cris_id_ss"=>["af9593eb-0fe4-4fb6-80b0-9572313cde95"], "affiliation_ts"=>["Department of Media, Cognition and Communication, Faculty of Humanities, Københavns Universitet", "Institut for Kommunikation og Kultur - Retorik", "Department of Media, Cognition and Communication, Faculty of Humanities, Københavns Universitet"], "access_condition_s"=>"submitted", "format_orig_s"=>"dba", "scientific_level_s"=>"scientific", "fulltext_availability_ss"=>["UNDETERMINED"], "source_id_ss"=>["rdb_ku:f3be054a-85f7-463f-ae2f-8ebb2c2f3273"], "source_type_ss"=>["research"], "affiliation_associations_json"=>"{\"editor\":[],\"supervisor\":[],\"author\":[2,1]}", "access_ss"=>["ddf_publ", "dtu", "ddf_pers"], "journal_title_ts"=>["Speechwriting in Our Time"], "journal_title_facet"=>["Speechwriting in Our Time"], "subformat_s"=>"bookchapter", "submission_year_tis"=>[2017], "member_id_ss"=>["565f2b1a4a5afafc6300007c"], "review_status_s"=>"peer_review", "language_ss"=>["eng"], "format"=>"article", "types_ss"=>["bib:article:bookchapter"], "pub_date_tis"=>[2017], "keywords_ts"=>["Faculty of Humanities", "Karaktertegning", "Ethopoiia", "Persona"], "keywords_facet"=>["Faculty of Humanities", "Karaktertegning", "Ethopoiia", "Persona"], "cluster_id_ss"=>["2289454234"], "author_ts"=>["Hansen, Jette Barnholdt", "Lund, Marie"], "author_facet"=>["Hansen, Jette Barnholdt", "Lund, Marie"], "superformat_s"=>"bib", "source_ext_ss"=>["dads:rdb_ku"], "id"=>"1460837184", "_version_"=>1535377524457996290, "timestamp"=>"2016-05-26T08:08:31.059Z", "score"=>1.0}, {"alert_timestamp_dt"=>"2016-02-16T23:14:38.811Z", "isolanguage_ss"=>["eng"], "isolanguage_facet"=>["eng"], "research_area_ss"=>["Social science"], "publisher_ts"=>["Routledge"], "title_ts"=>["Compromise and Disagreement in Comtemporary Political Theory"], "backlink_ss"=>["http://forskning.ku.dk/search/?pure=en/publications/id(8109680f-fbb6-4b2b-9c63-08e11543a6b2).html"], "source_ss"=>["rdb_ku"], "update_timestamp_dt"=>"2016-02-21T08:17:47.851Z", "cris_id_ss"=>["6b41854e-4700-4110-940a-099fd4af3831", "4de7f554-bcbb-4abb-b1c0-37bcc0e5c13d"], "access_condition_s"=>"in_press", "affiliation_ts"=>["Department of Political Science, Faculty of Social Sciences, Københavns Universitet", "Institut for Statskundskab, Department of Political Science, Faculty of Social Sciences, Københavns Universitet", "Political Theory, Department of Political Science, Faculty of Social Sciences, Københavns Universitet", "Institut for Statskundskab, Department of Political Science, Faculty of Social Sciences, Københavns Universitet", "Department of Political Science, Faculty of Social Sciences, Københavns Universitet"], "format_orig_s"=>"db", "scientific_level_s"=>"scientific", "fulltext_availability_ss"=>["UNDETERMINED"], "source_id_ss"=>["rdb_ku:8109680f-fbb6-4b2b-9c63-08e11543a6b2"], "source_type_ss"=>["research"], "affiliation_associations_json"=>"{\"editor\":[],\"supervisor\":[],\"author\":[3,4]}", "access_ss"=>["ddf_publ", "dtu", "ddf_pers"], "member_id_ss"=>["56c106f96c99ac963d00003e"], "review_status_s"=>"peer_review", "submission_year_tis"=>[2017], "language_ss"=>["eng"], "format"=>"book", "types_ss"=>["bib:book"], "pub_date_tis"=>[2017], "cluster_id_ss"=>["2292192160"], "author_ts"=>["Rostbøll, Christian F.", "Scavenius, Theresa"], "author_facet"=>["Rostbøll, Christian F.", "Scavenius, Theresa"], "superformat_s"=>"bib", "source_ext_ss"=>["dads:rdb_ku"], "id"=>"1466257259", "_version_"=>1535381485234683905, "timestamp"=>"2016-05-26T09:11:27.961Z", "score"=>1.0}]}, "facet_counts"=>{"facet_queries"=>{}, "facet_fields"=>{"format_orig_s"=>["dja", 135874, "dba", 30025, "db", 10563, "dcp", 9603, "dca", 8052, "dna", 4632, "dtp", 4611, "do", 4089, "dr", 3991, "dra", 3880, "dbp", 3602, "djb", 3138, "dw", 2872, "dco", 2820, "djr", 2441, "djc", 856, "dln", 799, "dtd", 241, "dp", 190, "dd", 47, "dso", 17], "pub_date_tsort"=>["2008", 13594, "2012", 13544, "2009", 13399, "2011", 13194, "2010", 13109, "2014", 12949, "2013", 12734, "2015", 12616, "2007", 10282, "2006", 10143, "2005", 9364, "2004", 8894, "2003", 7977, "2002", 7865, "2001", 7753, "2000", 7557, "1999", 7390, "1997", 6939, "1998", 6850, "1994", 4821, "1995", 4713, "1992", 4473, "1993", 4378, "1996", 3785, "1991", 3768, "2016", 3450, "1990", 1425, "1989", 877, "1988", 613, "1987", 534, "1986", 453, "1985", 409, "1984", 357, "1983", 329, "1982", 302, "1981", 232, "1980", 211, "1979", 158, "1978", 150, "1977", 115, "1976", 104, "1975", 81, "1973", 63, "1974", 60, "1972", 40, "1971", 36, "1970", 33, "2017", 28, "1969", 26, "1967", 16, "1968", 14, "1966", 10, "1965", 9, "1964", 6, "1962", 4, "2018", 4, "1961", 2, "1963", 2, "1952", 1, "1960", 1], "author_facet"=>["Astrup, Arne", 1259, "Holst, Jens Juul", 795, "Hansen, Jørn Dines", 769, "Hansen, Peter Henrik", 757, "Astrup, A.", 704, "Hansen, Jørgen Beck", 685, "Hansen, John Renner", 573, "Sandøe, Peter", 559, "Dam, Mogens", 505, "Nilsson, Björn Stefan", 478, "Xella, Stefania", 472], "source_ss"=>["rdb_ku", 232343, "rdb_sbi", 14365, "rdb_au", 3914, "rdb_sdu", 2803, "orbit", 2736, "rdb_vbn", 900, "rdb_ruc", 353, "rdb_cbs", 171, "rdb_ark", 62, "rdb_fak", 15, "rdb_itu", 14], "journal_title_facet"=>["Ugeskrift for Læger", 3637, "Ugeskr Laeger", 3635, "Ugeskr. Laeg", 3635, "Ugeskrift for Laeger", 1437, "Plos One", 1300, "Ikke Angivet", 1276, "Politiken", 1058, "Astron Astr", 825, "Astron Astrophys", 825, "Astron. Astrophys", 825, "Astronomy and Astrophysics", 825], "submission_year_tis"=>["2011", 13860, "2012", 13857, "2008", 13533, "2014", 13239, "2009", 13140, "2010", 12832, "2015", 12644, "2013", 12526, "2007", 10231, "2006", 10123, "2005", 9351, "2004", 8867, "2003", 7955, "2002", 7838, "2001", 7731, "2000", 7507, "1999", 7362, "1997", 6916, "1998", 6833, "1994", 4798, "1995", 4699, "1992", 4448, "1993", 4370, "1991", 3763, "1996", 3737, "2016", 3613, "1990", 1364, "1989", 861, "1988", 595, "1987", 508, "1986", 430, "1985", 389, "1984", 340, "1983", 311, "1982", 282, "1981", 227, "1980", 202, "1979", 157, "1978", 149, "1977", 114, "1976", 102, "1975", 81, "1973", 63, "1974", 60, "1972", 40, "1971", 36, "1970", 33, "2017", 29, "1969", 27, "1967", 16, "1968", 14, "1966", 10, "1965", 9, "1964", 6, "1800", 4, "1962", 4, "2018", 4, "1961", 2, "1963", 2, "1952", 1, "1960", 1], "isolanguage_ss"=>["eng", 171942, "dan", 53949, "ger", 1926, "swe", 844, "fre", 667, "und", 587, "spa", 551, "ita", 385, "nor", 328, "mul", 290, "chi", 129, "jpn", 103, "por", 102, "rus", 100, "ice", 90, "fin", 86, "fao", 82, "pol", 72, "dut", 48, "tur", 24, "lit", 21, "vie", 17], "scientific_level_s"=>["scientific", 205346, "popular", 23782, "educational", 3215], "access_condition_s"=>["published", 216111, "in_press", 1106, "unknown", 478, "submitted", 333], "review_status_s"=>["peer_review", 118663, "undetermined", 113680], "research_area_ss"=>["Science/technology", 98896, "Medical science", 58826, "Humanities", 44571, "Social science", 30050], "cris_id_ss"=>["5d943631-c9fc-4b63-8aaa-263ba4248735", 1952, "864b6401-9024-4773-9bdb-f4d4ca57dcad", 1169, "345fb959-70c0-4a6e-a04d-3104525442c7", 830, "d8420abc-38af-4499-a184-b284bbb8fe21", 768, "1cebcefa-bd9e-4114-8665-8445dd9354d9", 685, "1e8ff72f-573c-4453-9c10-e6e09658b1ed", 603, "b390a52a-7f61-4ee3-a230-555105d7b98c", 580, "c8bd9975-50bb-4e25-8dd3-a3738a78ec9b", 549, "e3f0c57c-605a-431a-9c63-2213c46621e6", 515, "573f2dce-0174-434c-b621-bc8cdb71f1a5", 513, "c29a2565-4c7e-4a5b-ab39-899baedae963", 511, "ee7b5a73-555e-4e57-8354-6c5c3933efc9", 484, "2cb8cf47-6b6b-4010-bdf6-9ec77c7deed3", 479, "e5852fa9-173b-44ae-9876-141620c68428", 475, "f71bedc6-3736-4559-b937-6a18e770616e", 474, "fac2e473-ee4c-480c-84b6-2bd96721d0a4", 468, "d24141a0-a1a1-408d-8503-242196b7c99d", 458, "1ca2a984-1fd7-4710-8c45-3fb9f660a311", 455, "943a8c9c-1a7a-436d-8fc2-ceec17d4cdba", 452, "050097bb-d799-4f5d-af5b-7e63c22b60fa", 448, "053be362-0815-46b3-9f59-c099f9c6922c", 438, "9dab27ed-3b7b-4a40-b944-1c0067e62930", 400, "af310f7a-c49b-4381-bcb4-cf56e3fd80d8", 397, "5b685517-9c35-44f6-bc78-098198f06739", 393, "d6ca6509-0bee-4705-86bb-b21238731e56", 393, "87dc6405-95a9-4a04-991f-c2b5c077aed8", 391, "abcd3923-e43e-4a0e-b104-4b6238e5afc8", 391, "2de9a5ad-04f9-471b-bbe3-80f19dd558b8", 389, "e1ff513c-cc7f-43e8-ac3d-742aee7fe1da", 388, "0a2a7ad3-1719-43c6-bdf3-c3491a43a8af", 382, "7a10be17-6e9a-4b5f-917e-7052145658e2", 381, "eb9b28bb-2658-4302-8342-2a662ef39d0c", 380, "6a809f42-2644-434a-9bec-a1fbf5e26093", 372, "733103b5-ddc2-416f-a686-48e694154a82", 371, "1d37b69c-39a9-4567-8b4f-f8cd4f8281de", 364, "cc94a7fc-b397-47b4-94a5-bde078bb4fb6", 362, "d19a1764-4b57-4401-a52a-10f4f9507a40", 362, "54d5ec55-f24e-4492-9e76-2c5478d312e0", 361, "b24f1014-2f14-42b2-9060-4b8c4e0a4df5", 360, "d0479434-e9c3-462b-b9b8-776c1964131f", 356, "7756c5a2-4573-42b9-b79a-e47392b2a0f2", 355, "368044df-7d2b-4204-9103-8c0272f1baca", 352, "20974a09-fa33-4324-8ec2-8b1608a5bd06", 349, "2bb49ea2-92b9-4978-a009-33b797fc1f80", 347, "bfcdb734-0295-4c33-a4f0-73dcbd8447d0", 347, "90a19b2f-0e2a-40b8-8431-f02134f2df89", 345, "fcadffe5-b969-43a4-a7f7-f3e5c07f133c", 345, "6d37a601-0e0d-4507-85dd-1539366656c9", 343, "774c3f15-2d50-42e9-ade6-d4f5223f44dc", 343, "e60f82ec-70a8-4c95-b9d7-f41755524bf3", 343, "20245e41-1eb4-4cfa-a2d6-e6851e101300", 340, "dd20dadd-5356-4314-bb70-4fe2b03328d5", 340, "c9ba60ad-a6b9-439f-bbd2-e6fd31a4e009", 331, "0a3c43a0-a0c5-4a91-85d6-6e80e16af8b5", 330, "9ffee5db-4198-4e8b-b589-f4aadfc5a583", 330, "d496d728-62c1-4162-854c-83f5f0fc5438", 329, "d7f792e1-ac2c-4d67-8887-3615a3a98edb", 329, "2953c67a-bd1f-4e9a-b85d-6734e4c8d2ab", 328, "9fcd1f8f-676c-4208-9e26-fed4252cf404", 325, "fa2b31a0-157d-41e9-a5d3-1dd2b406a1a3", 325, "ad83d627-4e78-4805-b4dc-e6917b6dc617", 324, "18527abd-c96b-4863-82e0-5bcbc4687934", 317, "976d5078-5219-47e6-b1db-0a9b618bc576", 316, "b907e7ef-d26a-4093-836b-9b7c9238d956", 313, "240d0bd3-4221-4d27-bfdb-8fd6887cdb30", 312, "f9b11983-c7c8-4111-b119-4de471572898", 312, "24839560-f889-42a6-9b73-97b69f101548", 311, "f841e488-c03e-472e-82f3-2f2d3cec7efa", 310, "00b94c43-5ffb-4e1e-ac75-320aa0c79745", 308, "937fdfff-254d-4c71-b00f-a593ba662428", 305, "ac5aba5f-0526-4cc6-9376-634b25a13ec1", 305, "b640ed80-95a1-48b8-937c-61b035b6c662", 305, "185c3ae4-342f-45a5-a650-182db1405d6f", 304, "6bb7ac90-2d34-4b0a-937c-52a1158ba9a2", 303, "5e659741-0d47-4f40-ab42-b8af1596d3b4", 302, "d0225a7f-ad88-418d-8660-bff37f7358d9", 302, "8c7956da-91f7-4c67-8c19-42bc9c446c87", 301, "74cb6e41-3bfc-4d0a-a0df-7bd8fa9c2856", 300, "ffab842e-9b80-4860-b92f-967f5009c779", 299, "7af020b5-3cb6-48cf-9002-177bc56b36f3", 294, "58d32614-fd52-4a13-9d64-99976fdb456e", 292, "17ab5e4d-4e75-4246-8d01-e476b08064b7", 288, "1f44c09a-eda8-4efb-a148-33cdc9fcd13a", 287, "f50bff62-cd6f-4c51-bf97-8e95c036bf99", 286, "13bcfb3c-97d0-4a70-ad0a-33c74fa7dac9", 283, "a11f0f2d-120f-475b-9d08-eadc2de0f6b6", 281, "d9edb9c8-a66e-442c-897a-8bb66dee31a3", 280, "9d088b47-fed4-4fee-8e63-6ae82c0f0131", 278, "e003b419-031d-44b1-987a-48454551a573", 278, "23e31554-6330-4153-9443-43d6e2951b3d", 274, "acec49c2-8e30-45f6-8785-19112c22d379", 274, "5076deba-174d-4a3a-a1cd-fb8e0411e8ed", 273, "cf857aa5-80e0-45c0-8a8b-6a682bc89bc1", 272, "79cc39b2-3e77-441c-922e-b5cde6ace7ac", 271, "ada7dbaf-6db7-442b-9f13-278c84e711f6", 270, "086303f2-0ce6-4201-81e4-1bb595ae520a", 268, "d8af669b-68c9-496e-989b-8d2448c301cd", 268, "8d00f12a-fe80-48ba-96c2-6769b91281e7", 267, "97d05224-2b67-4caf-9ee2-72f16c0b0a3c", 267, "9b553aa7-aebe-452e-b36f-b21edcff4e70", 267], "is_active_b"=>[], "has_orcid_b"=>[]}, "facet_dates"=>{}, "facet_ranges"=>{}, "facet_intervals"=>{}}, "highlighting"=>{"1469405281"=>{}, "1435909764"=>{}, "1445893859"=>{}, "1467970187"=>{}, "1469021783"=>{}, "1422920713"=>{}, "1469021778"=>{}, "1468629277"=>{}, "1460837184"=>{}, "1466257259"=>{}}, "stats"=>{"stats_fields"=>{"submission_year_tis"=>{"min"=>1800.0, "max"=>2018.0, "count"=>232246, "missing"=>97, "sum"=>465717780.0, "sumOfSquares"=>933906867312.0, "mean"=>2005.2779380484487, "stddev"=>7.5611627228930445, "facets"=>{}}, "pub_date_tsort"=>{"min"=>1952.0, "max"=>2018.0, "count"=>232246, "missing"=>97, "sum"=>465705388.0, "sumOfSquares"=>933857052296.0, "mean"=>2005.2245808323933, "stddev"=>7.527812986894412, "facets"=>{}}}}} }
  let(:parsed) { described_class.parse(response) }
  let(:test_api) { 'http://influxapi.test.dtu.dk:8089/write?db=dtu' }
  describe 'monitor' do
    it 'should make a http request to influx' do
      ENV['INFLUX_API'] = test_api
      stub = stub_request(:post, test_api).and_return(status: 204)
      described_class.monitor('test_app', response, Time.now.to_i)
      expect(stub).to have_been_requested
    end
  end

  describe 'parse_response' do
    it 'parses a solr response correctly' do
      expect(parsed[:value]).to eql 577
      expect(parsed[:status]).to eql 0
      expect(parsed[:q]).to eql 'x'
      expect(parsed[:num_docs]).to eql 232343
    end
  end
end
